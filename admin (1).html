<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Earning App</title>
    
    <!-- Ad Network Scripts -->
    <script async="async" data-cfasync="false" src="https://pl28087364.effectivegatecpm.com/5f0b65d762714132d66c6ba8945349f3/invoke.js"></script>
    <div id="container-5f0b65d762714132d66c6ba8945349f3"></div>  
    
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style>
        /* CSS STYLES */
        :root { --primary-color: #007bff; --secondary-color: #28a745; --background-color: #f0f2f5; --card-background: #ffffff; --text-color: #333333; --light-text-color: #888888; --border-color: #e0e0e0; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: var(--background-color); margin: 0; padding-bottom: 60px; color: var(--text-color); }
        .container { max-width: 450px; margin: 0 auto; background-color: var(--card-background); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); min-height: 100vh; display: flex; flex-direction: column; }
        
        /* Login Page Styles */
        #login-container { display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 30px; height: 100vh; box-sizing: border-box; background: white; z-index: 2000; position: fixed; top: 0; width: 100%; max-width: 450px; left: 50%; transform: translateX(-50%); }
        .login-logo { font-size: 60px; color: var(--primary-color); margin-bottom: 20px; }
        .login-title { font-size: 24px; font-weight: bold; margin-bottom: 10px; color: #333; }
        .login-subtitle { font-size: 14px; color: #666; margin-bottom: 30px; text-align: center; }
        .login-input { width: 100%; padding: 15px; border: 1px solid #ddd; border-radius: 10px; margin-bottom: 15px; font-size: 16px; outline: none; transition: border 0.3s; }
        .login-input:focus { border-color: var(--primary-color); }
        .otp-section { width: 100%; display: none; animation: slideUp 0.3s ease; }
        @keyframes slideUp { from {opacity:0; transform: translateY(10px);} to {opacity:1; transform: translateY(0);} }

        /* Main App Styles */
        .header { display: flex; align-items: center; padding: 10px 15px; background-color: var(--card-background); border-bottom: 1px solid var(--border-color); position: sticky; top: 0; z-index: 100; }
        .header-profile-pic { width: 40px; height: 40px; border-radius: 50%; margin-right: 12px; border: 2px solid var(--primary-color); background-color: #eee; object-fit: cover; }
        .header-user-info h3 { margin: 0; font-size: 16px; font-weight: 600; }
        .header-user-info p { margin: 0; font-size: 12px; color: var(--light-text-color); }
        .content { flex-grow: 1; padding: 20px; overflow-y: auto; }
        .card { background-color: var(--background-color); border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); text-align: center; border: 1px solid var(--border-color); }
        .card-header { font-size: 18px; font-weight: 600; margin-bottom: 15px; color: var(--text-color); display: flex; align-items: center; justify-content: center; }
        .card-header .material-icons, .card-header .fa-solid, .card-header .fa-brands { margin-right: 8px; color: var(--primary-color); }
        .balance-card .balance { font-size: 36px; font-weight: 700; color: var(--secondary-color); margin: 10px 0; }
        .card-label { font-size: 14px; color: var(--light-text-color); }
        .dashboard-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .dashboard-item { background-color: var(--card-background); border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); text-align: center; }
        .dashboard-item .material-icons { font-size: 32px; margin-bottom: 10px; color: var(--primary-color); }
        .dashboard-item-value { font-size: 24px; font-weight: 700; color: var(--text-color); }
        .dashboard-item-label { font-size: 12px; color: var(--light-text-color); }
        .primary-btn, .secondary-btn, .social-btn { border: none; padding: 15px; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; width: 100%; transition: background-color 0.3s, transform 0.2s; margin-top: 10px; display: inline-flex; align-items: center; justify-content: center; gap: 8px; text-decoration: none; box-sizing: border-box; }
        .primary-btn { background-color: var(--primary-color); color: #fff; }
        .primary-btn:hover { background-color: #0056b3; transform: translateY(-2px); }
        .primary-btn:disabled { background-color: #ccc; cursor: not-allowed; transform: none; }
        .secondary-btn { background-color: #f0f0f0; color: var(--text-color); border: 1px solid var(--border-color); }
        .secondary-btn:hover { background-color: #e0e0e0; transform: translateY(-2px); }
        
        /* Social Buttons */
        .social-btn { font-size: 14px; padding: 10px; margin-top: 8px; color: #fff; }
        .social-btn.like { background-color: #e91e63; }
        .social-btn.follow { background-color: #673ab7; }
        
        .progress-bar-container { height: 10px; background-color: #eee; border-radius: 5px; overflow: hidden; margin-top: 10px; }
        .progress-bar { height: 100%; background-color: var(--primary-color); width: 0; transition: width 0.5s ease-in-out; }
        .footer-nav { display: flex; justify-content: space-around; align-items: center; position: fixed; bottom: 0; width: 100%; max-width: 450px; background-color: var(--card-background); border-top: 1px solid var(--border-color); box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.05); z-index: 200; }
        .nav-item { display: flex; flex-direction: column; align-items: center; padding: 10px; cursor: pointer; color: var(--light-text-color); transition: color 0.3s; flex: 1; }
        .nav-item .material-icons { font-size: 24px; margin-bottom: 5px; }
        .nav-item-label { font-size: 12px; font-weight: 500; }
        .nav-item.active { color: var(--primary-color); }
        .page { display: none; animation: fadeIn 0.5s; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .profile-info, .withdraw-form-container { background-color: var(--card-background); border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); margin-top: 20px; border: 1px solid var(--border-color); }
        .profile-pic-container { width: 80px; height: 80px; border-radius: 50%; background-color: #eee; margin: 0 auto 15px; overflow: hidden; border: 3px solid var(--primary-color); }
        .profile-pic { width: 100%; height: 100%; object-fit: cover; }
        .profile-info-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #f0f0f0; }
        .profile-info-row:last-child { border-bottom: none; }
        .profile-label { font-size: 16px; color: var(--text-color); }
        .profile-value { font-size: 16px; font-weight: 600; color: var(--primary-color); }
        .form-group { margin-bottom: 15px; text-align: left; }
        .form-group label { display: block; margin-bottom: 5px; font-size: 14px; font-weight: 600; }
        .form-group input, .form-group select { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid var(--border-color); box-sizing: border-box; font-size: 16px; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        .modal-content { background-color: #fff; padding: 25px; border-radius: 15px; width: 85%; max-width: 400px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.3); animation: modalPop 0.3s ease-out; border: 1px solid #ddd; position: relative; max-height: 90vh; overflow-y: auto; }
        @keyframes modalPop { from {transform: scale(0.8); opacity: 0;} to {transform: scale(1); opacity: 1;} }
        .close-modal-btn { position: absolute; top: 10px; right: 15px; font-size: 28px; font-weight: bold; color: #888; cursor: pointer; line-height: 1; transition: color 0.3s; }
        .close-modal-btn:hover { color: #d32f2f; }
        .notice-title { color: #d32f2f; font-size: 18px; font-weight: 700; margin-bottom: 15px; margin-top: 10px; }
        .notice-body { font-size: 14px; color: #333; text-align: left; line-height: 1.6; margin-bottom: 20px; }
        .notice-body strong { color: #000; }
        .upload-section { margin-top: 15px; text-align: left; border-top: 1px solid #eee; padding-top: 15px; }
        .upload-label { font-size: 14px; font-weight: 600; margin-bottom: 5px; display: block; color: #555; }
        .file-input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px; margin-bottom: 10px; font-size: 13px; }
        .upload-status { font-size: 12px; color: #28a745; margin-top: 5px; display: none; }
        #loading-screen { position: fixed; top:0; left:0; width:100%; height:100%; background:#fff; z-index:9999; display:flex; justify-content:center; align-items:center; flex-direction:column; }
        .admin-notif-box { background: #fff3cd; color: #856404; border: 1px solid #ffeeba; padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: left; font-size: 14px; display: none; }
    </style>
</head>
<body>
    <!-- LOGIN PAGE -->
    <div id="login-container">
        <i class="material-icons login-logo">lock_person</i>
        <div class="login-title">Secure Login</div>
        <div class="login-subtitle">Enter your Telegram User ID to receive a verification code.</div>
        
        <div id="login-step-1" style="width: 100%;">
            <label style="text-align:left; display:block; font-size:12px; margin-bottom:5px; color:#555;">Telegram User ID (UID):</label>
            <input type="number" id="login-uid" class="login-input" placeholder="e.g. 123456789">
            <div style="font-size:11px; color:#888; text-align:left; margin-bottom:15px;">
                * Don't know your ID? Send <b>/start</b> to our bot to get it.
            </div>
            <button class="primary-btn" id="send-otp-btn">Send Verify Code</button>
        </div>

        <div id="login-step-2" class="otp-section">
            <div style="background:#e3f2fd; color:#0d47a1; padding:10px; border-radius:5px; font-size:13px; margin-bottom:15px;">
                ‚úÖ Code sent! Check your Telegram Bot.
            </div>
            <input type="number" id="login-otp" class="login-input" placeholder="Enter 6-digit Code">
            <button class="primary-btn" id="verify-otp-btn">Verify & Login</button>
            <button class="secondary-btn" onclick="location.reload()" style="margin-top:10px;">Cancel</button>
        </div>
    </div>

    <!-- Loading Screen (Internal) -->
    <div id="loading-screen" style="display:none;">
        <div style="font-size:24px; font-weight:bold; color:var(--primary-color);">Loading App...</div>
        <p>Connecting to server...</p>
    </div>

    <!-- Main App Container (Hidden by default) -->
    <div class="container" style="display:none;" id="main-app-container">
        <!-- Header -->
        <header class="header">
            <img id="header-profile-pic" src="https://via.placeholder.com/40" class="header-profile-pic">
            <div class="header-user-info">
                <h3 id="header-user-name">User</h3>
                <p>Welcome to Earning App</p>
            </div>
            <div style="margin-left:auto;">
                <button onclick="logout()" style="background:none; border:none; color:#d32f2f; cursor:pointer;">
                    <i class="material-icons">logout</i>
                </button>
            </div>
        </header>

        <main class="content">
            <!-- Home Page -->
            <section id="home-page" class="page active">
                <div id="home-notification-box" class="admin-notif-box">
                    <strong>üì¢ Admin Notice:</strong> <span id="home-notif-text">Loading...</span>
                </div>

                <div class="card balance-card">
                    <h2 class="card-header"><span class="material-icons">account_balance_wallet</span>My Balance</h2>
                    <div class="balance" id="current-balance">BDT 0.00</div>
                    <button class="primary-btn" onclick="showPage('earn-page')">Start Earning Now <span class="material-icons">arrow_forward</span></button>
                    <button class="secondary-btn" onclick="showPage('withdraw-page')">Withdraw <span class="material-icons">currency_exchange</span></button>
                </div>
                <div class="dashboard-grid">
                    <div class="dashboard-item">
                        <span class="material-icons" style="color: var(--secondary-color);">attach_money</span>
                        <div class="dashboard-item-value" id="total-earnings">BDT 0.00</div>
                        <div class="dashboard-item-label">Total Earnings</div>
                    </div>
                    <div class="dashboard-item">
                        <span class="material-icons" style="color: #ffc107;">visibility</span>
                        <div class="dashboard-item-value" id="ads-watched">0</div>
                        <div class="dashboard-item-label">Total Ads Watched</div>
                    </div>
                </div>
                <div class="card" style="margin-top: 20px;">
                    <div class="card-header"><span class="material-icons">group</span>Total Referrals</div>
                    <div class="dashboard-item-value" id="total-referrals">0</div>
                </div>
            </section>

            <!-- Earn Page -->
            <section id="earn-page" class="page">
                <div class="card" style="padding: 15px;">
                     <div style="text-align: left; margin-bottom: 10px;">
                        <div style="font-size: 14px; font-weight: 600;">Hourly Task Progress:</div>
                        <div style="font-size: 12px; color: var(--light-text-color);" id="ad-progress-text">Completed: 0 / 20</div>
                        <div id="reset-timer-display" style="font-size: 12px; color: #d32f2f; display: none; font-weight: bold;"></div>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="ad-progress-bar"></div>
                    </div>
                </div>

                <div class="card">
                    <h2 class="card-header"><span class="material-icons">task</span>Premium Task 1</h2>
                    <button class="primary-btn" id="task-btn-1">Start Task 1 <span class="material-icons">open_in_new</span></button>
                </div>

                <div class="card">
                    <h2 class="card-header"><span class="material-icons">verified</span>Premium Task 2</h2>
                    <button class="primary-btn" id="task-btn-2">Start Task 2 <span class="material-icons">open_in_new</span></button>
                </div>

                <div class="card">
                    <h2 class="card-header"><span class="material-icons">star</span>Premium Task 3</h2>
                    <button class="primary-btn" id="task-btn-3">Start Task 3 <span class="material-icons">open_in_new</span></button>
                </div>

                <!-- SOCIAL MEDIA TASKS -->
                <div style="margin: 25px 0 10px; font-weight:bold; color:#555; text-align:left;">Social Media Tasks</div>
                <div class="card">
                    <h2 class="card-header"><i class="fa-brands fa-tiktok"></i> TikTok Task</h2>
                    <div style="display: flex; gap: 10px;">
                        <button class="social-btn like" onclick="initiateSocialTask('tiktok', 'like')">Like (BDT 0.5)</button>
                        <button class="social-btn follow" onclick="initiateSocialTask('tiktok', 'follow')">Follow (BDT 0.6)</button>
                    </div>
                </div>
                <div class="card">
                    <h2 class="card-header"><i class="fa-brands fa-youtube" style="color: red;"></i> YouTube Task</h2>
                    <div style="display: flex; gap: 10px;">
                        <button class="social-btn like" onclick="initiateSocialTask('youtube', 'like')">Like (BDT 0.5)</button>
                        <button class="social-btn follow" style="background-color: #c4302b;" onclick="initiateSocialTask('youtube', 'follow')">Subscribe (BDT 0.6)</button>
                    </div>
                </div>
                <div class="card">
                    <h2 class="card-header"><i class="fa-brands fa-facebook" style="color: #1877f2;"></i> Facebook Task</h2>
                    <div style="display: flex; gap: 10px;">
                        <button class="social-btn like" onclick="initiateSocialTask('facebook', 'like')">Like (BDT 0.5)</button>
                        <button class="social-btn follow" style="background-color: #1877f2;" onclick="initiateSocialTask('facebook', 'follow')">Follow (BDT 0.6)</button>
                    </div>
                </div>
                <div class="card">
                    <h2 class="card-header"><i class="fa-brands fa-instagram" style="color: #c13584;"></i> Instagram Task</h2>
                    <div style="display: flex; gap: 10px;">
                        <button class="social-btn like" onclick="initiateSocialTask('instagram', 'like')">Like (BDT 0.5)</button>
                        <button class="social-btn follow" style="background: linear-gradient(45deg, #f09433 0%,#e6683c 25%,#dc2743 50%,#cc2366 75%,#bc1888 100%);" onclick="initiateSocialTask('instagram', 'follow')">Follow (BDT 0.6)</button>
                    </div>
                </div>

                <div class="card" style="border: 2px solid var(--secondary-color);">
                    <h2 class="card-header"><span class="material-icons" style="color: var(--secondary-color);">camera_alt</span>Banner Task 4</h2>
                    <p style="font-size: 13px; color: #666; margin-bottom: 10px;">Complete this premium banner task to earn BDT 0.50!</p>
                    <button class="primary-btn" id="task-btn-4" style="background-color: var(--secondary-color);">Start Task 4 <span class="material-icons">open_in_new</span></button>
                </div>
            </section>
            
            <!-- Withdraw Page -->
            <section id="withdraw-page" class="page">
                <div class="card">
                    <h2 class="card-header"><span class="material-icons">currency_exchange</span>Withdraw Your Earnings</h2>
                    <div class="balance" id="withdraw-balance-display">BDT 0.00</div>
                    <div class="card-label">Current Balance</div>
                    <div style="margin-top: 20px; font-size: 14px; color: var(--light-text-color);">
                        <b>Minimum Withdraw Limits:</b><br>
                        bKash: BDT 100.00<br>
                        WebMoney: BDT 500.00
                    </div>
                </div>
                
                <div class="withdraw-form-container">
                    <h4 style="margin-top: 0; text-align: left;">Withdraw Details</h4>
                    <form id="withdraw-form">
                        <div class="form-group">
                            <label for="withdraw-method">Withdraw Method</label>
                            <select id="withdraw-method" required>
                                <option value="" disabled selected>Select a method</option>
                                <option value="bkash">bKash (Min 100)</option>
                                <option value="webmoney">WebMoney (Min 500)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="account-number">Account Number</label>
                            <input type="text" id="account-number" placeholder="Enter Account Number" required>
                        </div>
                        <div class="form-group">
                            <label for="withdraw-amount">Amount (BDT)</label>
                            <input type="number" id="withdraw-amount" placeholder="Enter amount to withdraw" required>
                        </div>
                        <button type="submit" class="primary-btn" id="submit-withdraw-btn">Submit Withdraw Request</button>
                    </form>
                </div>
            </section>

            <!-- Profile Page -->
            <section id="profile-page" class="page">
                <div class="card" style="padding: 30px;">
                    <div class="profile-pic-container">
                        <img id="profile-page-pic" src="https://via.placeholder.com/80" class="profile-pic">
                    </div>
                    <h3 id="profile-user-name" style="margin: 0; font-weight: 600;">User</h3>
                    <p id="profile-user-username" style="margin: 5px 0 0; color: var(--light-text-color); font-size: 14px;">@telegram</p>
                    <p id="profile-user-id" style="margin: 2px 0 0; color: #999; font-size: 12px;">ID: 00000</p>
                </div>
                <div class="profile-info">
                    <h4 style="margin-top: 0; text-align:left;">My Profile</h4>
                    <div class="profile-info-row"><span class="profile-label">Current Balance</span><span class="profile-value" id="profile-balance">BDT 0.00</span></div>
                    <div class="profile-info-row"><span class="profile-label">Total Earnings</span><span class="profile-value" id="profile-earnings">BDT 0.00</span></div>
                    <div class="profile-info-row"><span class="profile-label">Total Ads Watched</span><span class="profile-value" id="profile-ads-watched">0</span></div>
                    <div class="profile-info-row"><span class="profile-label">Total Referrals</span><span class="profile-value" id="profile-referrals">0</span></div>
                </div>
            </section>
        </main>

        <nav class="footer-nav">
            <div class="nav-item active" data-page="home-page"><span class="material-icons">home</span><span class="nav-item-label">Home</span></div>
            <div class="nav-item" data-page="earn-page"><span class="material-icons">play_circle</span><span class="nav-item-label">Earn</span></div>
            <div class="nav-item" data-page="withdraw-page"><span class="fa-solid fa-credit-card"></span><span class="nav-item-label">Withdraw</span></div>
            <div class="nav-item" data-page="profile-page"><span class="material-icons">person</span><span class="nav-item-label">Profile</span></div>
        </nav>
    </div>

    <!-- MODALS -->
    <div id="task-notice-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal-btn" onclick="document.getElementById('task-notice-modal').classList.remove('active')">&times;</span>
            <div class="notice-title">üì¢ ‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶®‡ßã‡¶ü‡¶ø‡¶∂</div>
            <div class="notice-body">
                ‚ñ∂Ô∏è <strong>Start</strong> ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶Æ‡¶®‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶ì‡ßü‡ßá‡¶¨‡¶∏‡¶æ‡¶á‡¶ü ‡¶ì‡¶™‡ßá‡¶® ‡¶π‡¶¨‡ßá‡•§<br>
                ‚è≥ ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶∏‡ßá‡¶á ‡¶ì‡ßü‡ßá‡¶¨‡¶∏‡¶æ‡¶á‡¶ü‡ßá ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá <strong>‡ßß‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°</strong> ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§
            </div>
            <button id="modal-start-btn" class="primary-btn">Start <span class="material-icons">play_arrow</span></button>
        </div>
    </div>

    <div id="banner-notice-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal-btn" onclick="document.getElementById('banner-notice-modal').classList.remove('active')">&times;</span>
            <div class="notice-title">üì¢ Banner Task Rules</div>
            <div id="banner-step-1">
                <div class="notice-body" style="text-align: left;">
                    üëâ Click Start<br>üåê Visit Website<br>üì∏ Take 2 Screenshots<br><strong>Reward: BDT 0.50</strong>
                </div>
                <button id="banner-modal-start-btn" class="primary-btn">Start <span class="material-icons">play_arrow</span></button>
            </div>
            <div id="banner-step-2" style="display: none;">
                <div class="notice-body" style="text-align: center;">Upload 2 Screenshots</div>
                <div class="upload-section">
                    <input type="file" id="proof-1" class="file-input" accept="image/*"><input type="file" id="proof-2" class="file-input" accept="image/*">
                </div>
                <button id="submit-proof-btn" class="primary-btn" style="background-color: var(--secondary-color);">Submit Proofs</button>
                <div id="upload-status" class="upload-status">Uploading...</div>
            </div>
        </div>
    </div>
    
    <div id="social-task-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal-btn" onclick="document.getElementById('social-task-modal').classList.remove('active')">&times;</span>
            <div class="notice-title">üì¢ Social Task</div>
            <div id="social-step-1">
                <div class="notice-body" style="text-align: left;">
                    1Ô∏è‚É£ Open App<br>2Ô∏è‚É£ Complete Action<br>3Ô∏è‚É£ Take Screenshot<br><strong id="social-reward-text" style="color: green; display:block; margin-top:5px;">Reward: BDT 0.50</strong>
                </div>
                <button id="social-start-btn" class="primary-btn">Open App <span class="material-icons">open_in_new</span></button>
            </div>
            <div id="social-step-2" style="display: none;">
                <div class="notice-body" style="text-align: center;">‚úÖ Upload Proof Screenshot</div>
                <div class="upload-section"><input type="file" id="social-proof-file" class="file-input" accept="image/*"></div>
                <button id="social-submit-btn" class="primary-btn" style="background-color: var(--secondary-color);">Submit Proof <span class="material-icons">cloud_upload</span></button>
                <div id="social-upload-status" class="upload-status">Uploading...</div>
            </div>
        </div>
    </div>
    
    <div id="notification-modal" class="modal">
        <div class="modal-content" style="background: #fff; border-top: 5px solid #d32f2f;">
            <span class="close-modal-btn" onclick="document.getElementById('notification-modal').classList.remove('active')">&times;</span>
            <div class="notice-title">üîî Admin Notification</div>
            <div class="notice-body" id="modal-notif-body"></div>
            <button class="primary-btn" onclick="document.getElementById('notification-modal').classList.remove('active')">OK</button>
        </div>
    </div>

    <!-- FIREBASE MODULE SCRIPT -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
        import { getDatabase, ref, get, set, update, push, onValue, serverTimestamp, query, orderByChild, equalTo } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js";

        const firebaseConfig = {
          apiKey: "AIzaSyCVfj_1OEiE3nwDRF0C4KA6QJtnXiDI544",
          authDomain: "earnfree-baad5.firebaseapp.com",
          databaseURL: "https://earnfree-baad5-default-rtdb.firebaseio.com",
          projectId: "earnfree-baad5",
          storageBucket: "earnfree-baad5.firebasestorage.app",
          messagingSenderId: "165522705204",
          appId: "1:165522705204:web:5841f3d17afd86ae077361"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // CONFIGURATION
        const BOT_TOKEN = '8517755201:AAFAnwqBFjtc9NZcTdXHzUtNDEJtZ0c6OKs'; // Replace with your actual Bot Token
        const CHAT_ID = '@earnfree0t';
        
        const HOURLY_ADS_LIMIT = 20;
        const SESSION_DURATION = 60 * 60 * 1000;
        const AD_REWARD = 0.02;
        const BANNER_TASK_REWARD = 0.50;
        const SOCIAL_LIKE_REWARD = 0.50;
        const SOCIAL_FOLLOW_REWARD = 0.60;
        const MIN_BKASH_WITHDRAW = 100;
        const MIN_WEBMONEY_WITHDRAW = 500;

        let LINKS = { link1: "https://google.com", link2: "https://google.com", link3: "https://google.com", link4: "https://google.com", tiktok_like: "https://tiktok.com", tiktok_follow: "https://tiktok.com", youtube_like: "https://youtube.com", youtube_follow: "https://youtube.com", facebook_like: "https://facebook.com", facebook_follow: "https://facebook.com", instagram_like: "https://instagram.com", instagram_follow: "https://instagram.com" };

        let currentUser = null;
        let userId = null; 
        let countdownInterval;
        let pendingTaskUrl = ''; 
        let pendingRewardAmount = 0;
        let lastNotifId = null;
        letgeneratedOtp = null;
        let loginChatId = null;

        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        // --- LOGIN LOGIC START ---

        // Check Login State on Load
        document.addEventListener('DOMContentLoaded', () => {
            const savedUid = localStorage.getItem('earnApp_uid');
            // If already logged in, skip login screen
            if (savedUid) {
                userId = savedUid;
                startApp();
            } else {
                // Check if opened inside Telegram and ID is available
                if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                     // Auto-fill ID but require verification if strict, 
                     // OR just auto-login since Telegram verified them.
                     // To follow your prompt "send code", we will prompt even if in TG,
                     // but auto-fill the input.
                     document.getElementById('login-uid').value = tg.initDataUnsafe.user.id;
                }
                document.getElementById('login-container').style.display = 'flex';
            }
        });

        // 1. Send OTP
        document.getElementById('send-otp-btn').addEventListener('click', async () => {
            const inputId = document.getElementById('login-uid').value.trim();
            if (!inputId) { tg.showAlert("Please enter your Telegram User ID"); return; }
            
            loginChatId = inputId;
            const otp = Math.floor(100000 + Math.random() * 900000); // 6 Digit Code
            generatedOtp = otp;

            const btn = document.getElementById('send-otp-btn');
            btn.disabled = true;
            btn.innerText = "Sending...";

            // Send via Bot API
            const message = `üîê *Verification Code*\n\nYour code is: \`${otp}\`\n\nEnter this in the app to login.`;
            const url = `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${loginChatId}&text=${encodeURIComponent(message)}&parse_mode=Markdown`;

            try {
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.ok) {
                    document.getElementById('login-step-1').style.display = 'none';
                    document.getElementById('login-step-2').style.display = 'block';
                    tg.showAlert("Code sent to your Telegram!");
                } else {
                    tg.showAlert("Failed to send code. Please start the bot first: /start");
                    btn.disabled = false;
                    btn.innerText = "Send Verify Code";
                }
            } catch (e) {
                tg.showAlert("Connection Error");
                btn.disabled = false;
                btn.innerText = "Send Verify Code";
            }
        });

        // 2. Verify OTP
        document.getElementById('verify-otp-btn').addEventListener('click', () => {
            const userOtp = document.getElementById('login-otp').value.trim();
            if (userOtp == generatedOtp) {
                // Success
                userId = loginChatId;
                localStorage.setItem('earnApp_uid', userId); // Save Login
                document.getElementById('login-container').style.display = 'none';
                startApp();
            } else {
                tg.showAlert("Invalid Code. Try again.");
            }
        });

        // Logout
        window.logout = function() {
            localStorage.removeItem('earnApp_uid');
            location.reload();
        }

        // --- APP INITIALIZATION ---

        function startApp() {
            document.getElementById('loading-screen').style.display = 'flex';
            
            // Listen to Firebase User Data
            const userRef = ref(db, 'users/' + userId);
            onValue(userRef, (snapshot) => {
                const data = snapshot.val();
                
                document.getElementById('loading-screen').style.display = 'none';
                document.getElementById('main-app-container').style.display = 'flex';

                if (data) {
                    currentUser = data;
                    updateUI(data);
                } else {
                    // Create New User
                    let tgData = {};
                    if(tg.initDataUnsafe && tg.initDataUnsafe.user) tgData = tg.initDataUnsafe.user;
                    
                    const newUser = {
                        balance: 0,
                        totalEarnings: 0,
                        adsWatched: 0,
                        hourlyAdsWatched: 0,
                        adSessionStart: 0,
                        referrals: 0,
                        name: tgData.first_name ? `${tgData.first_name} ${tgData.last_name||''}` : `User ${userId}`,
                        username: tgData.username || 'unknown',
                        userId: userId
                    };
                    set(userRef, newUser);
                    currentUser = newUser;
                    updateUI(newUser);
                }
            });

            // Listen to Settings
            onValue(ref(db, 'settings'), (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    Object.keys(LINKS).forEach(key => { if (data[key]) LINKS[key] = data[key]; });
                }
            });

            // Listen to Admin Notifications
            onValue(ref(db, 'admin_notification'), (snapshot) => {
                const data = snapshot.val();
                if (data && data.message) {
                    document.getElementById('home-notification-box').style.display = 'block';
                    document.getElementById('home-notif-text').textContent = data.message;
                    if (data.id && data.id !== lastNotifId) {
                        lastNotifId = data.id;
                        document.getElementById('modal-notif-body').innerHTML = data.message;
                        document.getElementById('notification-modal').classList.add('active');
                    }
                } else {
                    document.getElementById('home-notification-box').style.display = 'none';
                }
            });
        }

        // --- UI & LOGIC FUNCTIONS ---
        function updateUI(user) {
            document.getElementById('header-user-name').textContent = user.name || 'User';
            document.getElementById('profile-user-name').textContent = user.name || 'User';
            document.getElementById('profile-user-username').textContent = user.username ? `@${user.username}` : '';
            document.getElementById('profile-user-id').textContent = `ID: ${userId}`;

            const formattedBalance = parseFloat(user.balance || 0).toFixed(2);
            document.getElementById('current-balance').textContent = `BDT ${formattedBalance}`;
            document.getElementById('withdraw-balance-display').textContent = `BDT ${formattedBalance}`;
            document.getElementById('total-earnings').textContent = `BDT ${parseFloat(user.totalEarnings || 0).toFixed(2)}`;
            document.getElementById('ads-watched').textContent = user.adsWatched || 0;
            document.getElementById('total-referrals').textContent = user.referrals || 0;
            
            document.getElementById('profile-balance').textContent = `BDT ${formattedBalance}`;
            document.getElementById('profile-earnings').textContent = `BDT ${parseFloat(user.totalEarnings || 0).toFixed(2)}`;
            document.getElementById('profile-ads-watched').textContent = user.adsWatched || 0;
            document.getElementById('profile-referrals').textContent = user.referrals || 0;

            const hourlyAds = user.hourlyAdsWatched || 0;
            const sessionStart = user.adSessionStart || 0;
            const now = Date.now();
            
            if (sessionStart > 0 && (now - sessionStart >= SESSION_DURATION)) {
                update(ref(db, 'users/' + userId), { hourlyAdsWatched: 0, adSessionStart: 0 });
                return;
            }

            document.getElementById('ad-progress-text').textContent = `Completed: ${hourlyAds} / ${HOURLY_ADS_LIMIT}`;
            document.getElementById('ad-progress-bar').style.width = `${(hourlyAds / HOURLY_ADS_LIMIT) * 100}%`;

            const btns = [
                document.getElementById('task-btn-1'),
                document.getElementById('task-btn-2'),
                document.getElementById('task-btn-3'),
                document.getElementById('task-btn-4')
            ];

            if (hourlyAds >= HOURLY_ADS_LIMIT && sessionStart > 0) {
                const timeLeft = SESSION_DURATION - (now - sessionStart);
                if (timeLeft > 0) {
                    startTimer(timeLeft, btns);
                    document.getElementById('reset-timer-display').style.display = 'block';
                    btns.forEach(b => b.disabled = true);
                } else {
                    update(ref(db, 'users/' + userId), { hourlyAdsWatched: 0, adSessionStart: 0 });
                }
            } else {
                if (countdownInterval) clearInterval(countdownInterval);
                document.getElementById('reset-timer-display').style.display = 'none';
                btns.forEach((b, i) => {
                    b.disabled = false;
                    b.innerHTML = `Start Task ${i + 1} <span class="material-icons">open_in_new</span>`;
                });
            }
            updateWithdrawButtonState(user.balance);
        }

        function startTimer(timeLeft, btns) {
            if (countdownInterval) clearInterval(countdownInterval);
            function tick() {
                if (timeLeft <= 0) {
                    clearInterval(countdownInterval);
                    update(ref(db, 'users/' + userId), { hourlyAdsWatched: 0, adSessionStart: 0 });
                    return;
                }
                const m = Math.floor((timeLeft % (3600000)) / 60000);
                const s = Math.floor((timeLeft % 60000) / 1000);
                const timeStr = `${m}m ${s}s`;
                document.getElementById('reset-timer-display').textContent = `Next Tasks available in: ${timeStr}`;
                btns.forEach(b => b.innerHTML = `Wait ${timeStr}`);
                timeLeft -= 1000;
            }
            tick();
            countdownInterval = setInterval(tick, 1000);
        }

        function initiateTask(url, reward, isBanner = false) {
            if (currentUser.hourlyAdsWatched >= HOURLY_ADS_LIMIT) { tg.showAlert("Hourly limit reached!"); return; }
            pendingTaskUrl = url;
            pendingRewardAmount = reward;

            if (isBanner) {
                document.getElementById('banner-step-1').style.display = 'block';
                document.getElementById('banner-step-2').style.display = 'none';
                document.getElementById('proof-1').value = '';
                document.getElementById('proof-2').value = '';
                document.getElementById('upload-status').style.display = 'none';
                document.getElementById('banner-notice-modal').classList.add('active');
            } else {
                document.getElementById('task-notice-modal').classList.add('active');
            }
        }

        window.initiateSocialTask = function(platform, type) {
            let linkKey = platform + '_' + type; 
            let url = LINKS[linkKey] || 'https://google.com';
            let reward = (type === 'like') ? SOCIAL_LIKE_REWARD : SOCIAL_FOLLOW_REWARD;
            
            pendingTaskUrl = url;
            pendingRewardAmount = reward;

            document.getElementById('social-step-1').style.display = 'block';
            document.getElementById('social-step-2').style.display = 'none';
            document.getElementById('social-proof-file').value = '';
            document.getElementById('social-upload-status').style.display = 'none';
            document.getElementById('social-reward-text').innerText = `Reward: BDT ${reward.toFixed(2)}`;
            document.getElementById('social-task-modal').classList.add('active');
        };

        function handleReward(amount) {
            const now = Date.now();
            let updates = {};
            updates['balance'] = (parseFloat(currentUser.balance || 0) + amount);
            updates['totalEarnings'] = (parseFloat(currentUser.totalEarnings || 0) + amount);
            updates['adsWatched'] = (currentUser.adsWatched || 0) + 1;
            updates['hourlyAdsWatched'] = (currentUser.hourlyAdsWatched || 0) + 1;
            if (!currentUser.adSessionStart || currentUser.adSessionStart === 0) {
                updates['adSessionStart'] = now;
            }
            update(ref(db, 'users/' + userId), updates)
                .then(() => tg.showAlert(`Success! BDT ${amount.toFixed(2)} added.`))
                .catch(e => tg.showAlert("Error updating balance."));
        }

        async function uploadProofToTelegram(file, captionSuffix = "") {
            const formData = new FormData();
            formData.append("chat_id", CHAT_ID);
            formData.append("photo", file);
            formData.append("caption", `Proof from: ${currentUser.name} (ID: ${userId})\n${captionSuffix}`);
            await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, { method: "POST", body: formData });
        }

        // Event Listeners for Tasks
        document.getElementById('modal-start-btn').addEventListener('click', () => {
            document.getElementById('task-notice-modal').classList.remove('active');
            window.open(pendingTaskUrl, '_blank');
            setTimeout(() => handleReward(pendingRewardAmount), 5000);
        });

        document.getElementById('banner-modal-start-btn').addEventListener('click', () => {
            window.open(pendingTaskUrl, '_blank');
            document.getElementById('banner-step-1').style.display = 'none';
            document.getElementById('banner-step-2').style.display = 'block';
        });

        document.getElementById('social-start-btn').addEventListener('click', () => {
             window.open(pendingTaskUrl, '_blank');
             document.getElementById('social-step-1').style.display = 'none';
             document.getElementById('social-step-2').style.display = 'block';
        });

        document.getElementById('submit-proof-btn').addEventListener('click', async () => {
            const f1 = document.getElementById('proof-1').files[0];
            const f2 = document.getElementById('proof-2').files[0];
            const btn = document.getElementById('submit-proof-btn');
            const status = document.getElementById('upload-status');

            if (!f1 || !f2) { tg.showAlert("Please upload both screenshots."); return; }
            btn.disabled = true;
            status.style.display = 'block';
            status.innerText = "Sending...";

            try {
                await uploadProofToTelegram(f1, "Banner Task - Home");
                await uploadProofToTelegram(f2, "Banner Task - Login");
                status.innerText = "Done!";
                setTimeout(() => {
                    document.getElementById('banner-notice-modal').classList.remove('active');
                    handleReward(pendingRewardAmount);
                    btn.disabled = false;
                }, 1000);
            } catch (e) {
                status.innerText = "Failed.";
                btn.disabled = false;
            }
        });

        document.getElementById('social-submit-btn').addEventListener('click', async () => {
            const f1 = document.getElementById('social-proof-file').files[0];
            const btn = document.getElementById('social-submit-btn');
            const status = document.getElementById('social-upload-status');

            if (!f1) { tg.showAlert("Please upload screenshot."); return; }
            btn.disabled = true;
            status.style.display = 'block';
            status.innerText = "Sending...";

            try {
                await uploadProofToTelegram(f1, `Social Task - Reward: ${pendingRewardAmount}`);
                status.innerText = "Done!";
                setTimeout(() => {
                    document.getElementById('social-task-modal').classList.remove('active');
                    handleReward(pendingRewardAmount);
                    btn.disabled = false;
                }, 1000);
            } catch (e) {
                status.innerText = "Failed.";
                btn.disabled = false;
            }
        });

        document.querySelectorAll('.close-modal-btn').forEach(btn => {
            btn.addEventListener('click', (e) => { e.target.closest('.modal').classList.remove('active'); });
        });

        document.getElementById('task-btn-1').addEventListener('click', () => initiateTask(LINKS.link1, AD_REWARD));
        document.getElementById('task-btn-2').addEventListener('click', () => initiateTask(LINKS.link2, AD_REWARD));
        document.getElementById('task-btn-3').addEventListener('click', () => initiateTask(LINKS.link3, AD_REWARD));
        document.getElementById('task-btn-4').addEventListener('click', () => initiateTask(LINKS.link4, BANNER_TASK_REWARD, true));

        window.showPage = (pageId) => {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            document.querySelector(`.nav-item[data-page="${pageId}"]`).classList.add('active');
        };

        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => showPage(item.getAttribute('data-page')));
        });

        const withdrawMethod = document.getElementById('withdraw-method');
        withdrawMethod.addEventListener('change', () => updateWithdrawButtonState(currentUser ? currentUser.balance : 0));

        function updateWithdrawButtonState(balance) {
            const method = withdrawMethod.value;
            let min = MIN_BKASH_WITHDRAW;
            if (method === 'webmoney') min = MIN_WEBMONEY_WITHDRAW;
            const btn = document.getElementById('submit-withdraw-btn');
            if (parseFloat(balance) < min) {
                btn.disabled = true;
                btn.innerText = `Min Withdraw BDT ${min}`;
            } else {
                btn.disabled = false;
                btn.innerText = "Submit Withdraw Request";
            }
        }

        document.getElementById('withdraw-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const amount = parseFloat(document.getElementById('withdraw-amount').value);
            const method = withdrawMethod.value;
            const account = document.getElementById('account-number').value;
            let min = method === 'webmoney' ? MIN_WEBMONEY_WITHDRAW : MIN_BKASH_WITHDRAW;

            if (amount < min) { tg.showAlert(`Minimum amount is BDT ${min}`); return; }
            if (amount > parseFloat(currentUser.balance)) { tg.showAlert("Insufficient balance."); return; }

            tg.showConfirm(`Withdraw BDT ${amount} via ${method}?`, (ok) => {
                if (ok) {
                    const newBalance = parseFloat(currentUser.balance) - amount;
                    update(ref(db, 'users/' + userId), { balance: newBalance });
                    push(ref(db, 'withdrawals'), {
                        userId: userId,
                        userName: currentUser.name,
                        amount: amount,
                        method: method,
                        account: account,
                        status: 'Pending',
                        timestamp: serverTimestamp()
                    });
                    document.getElementById('withdraw-form').reset();
                    tg.showAlert("Withdrawal request submitted!");
                }
            });
        });
    </script>
</body>
</html>
